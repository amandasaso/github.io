<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="no-feedback" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Operators &amp; Expressions">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Mapping IP&#160;addresses with the geo lookup operator</title>
        <link href="Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="Resources/Stylesheets/Styles.css" rel="stylesheet" />
        <script src="Resources/Scripts/jquery.min.js">
        </script>
        <script src="Resources/Scripts/plugins.min.js">
        </script>
        <script src="Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop" style="display: none;"><a href="Default.htm#Geo_lookup_operator.htm">Open topic with navigation</a>
        </p>
        <script type="text/javascript">/* <![CDATA[ */
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-16579649-1']);
			_gaq.push(['_trackPageview']);
			(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		/* ]]> */</script>
        <h1>Mapping IP&#160;addresses with the geo lookup operator</h1>
        <p>Sumo Logic can now match an extracted IP address to it's geographical location on a map. To create the map, after parsing the IP addresses from log files, the <b>lookup</b> operator matches extracted IP addresses to the physical location where the addresses originated. Finally, geo-location fields are used by the Google Maps API to add the IPs to a map. The latitude and longitude fields are required; optional fields are country_code, country_name, region, city, postal_code, area_code, and metro_code. Depending on how specific you’d like the output to be, you can include all the optional fields, or choose a subset.</p>
        <h2>Syntax</h2>
        <p>To produce a map, your query should use the following syntax:</p>
        <p><b>| parse “[ip_fieldname]” as [ip_address] </b>
            <br style="font-weight: bold;" /><b>| lookup latitude, longitude, [optional_geo_locator fields] from geo://default on ip=[ip_address] </b>
            <br style="font-weight: bold;" /><b>| count by latitude, longitude, [other geo_locator fields] </b>
            <br style="font-weight: bold;" /><b>| sort_count</b>
        </p>
        <p>Because this syntax produces aggregate results, you can add a map to a Dashboard.</p>
        <h2>Example</h2>
        <p>Sample log message:</p>
        <p class="code">2012-12-13 10:29:17,037 -0800 INFO  [hostId=prod-frontend-1] [module=SERVICE] [logger=service.endpoint.auth.v1.impl.AuthenticationServiceDelegate [thread=btpool0-8] [remote_ip=67.180.85.25] Successful login for user 'da@users.com', organization: '0000000000000005</p>
        <p>Using the example log, running a query like this:</p>
        <p><b>| parse "remote_ip=*]" as remote_ip</b>
            <br style="font-weight: bold;" /><b>| lookup latitude, longitude, country_code, country_name, region, city, postal_code, area_code, metro_code from geo://default on ip = remote_ip</b>
            <br style="font-weight: bold;" /><b>| count by latitude, longitude, country_code, country_name, region, city, postal_code, area_code, metro_code</b>
            <br style="font-weight: bold;" /><b>| sort _count</b>
        </p>
        <p>would produce the following results:</p>
        <p>
            <img src="Resources/Images/Geo_lookup_world_map_833x425.png" style="width: 833;height: 425;" />
        </p>
        <h2>Running a geo lookup query</h2>
        <p>Enter a query that parses the IP field from your logs, a lookup operator to match IP addresses to a lookup table, and then the geo-location fields you’d like to use to chart each IP address.</p>
        <ol>
            <li value="1">Run a geo lookup query. By default, results display as a table:<br /><br /><img src="Resources/Images/Geo_lookup_aggregates_378x298.png" style="width: 378;height: 298;" /><br /><br /></li>
            <li value="2">Click the Map icon in the Aggregates tab. The map displays:<br /><br /><img src="Resources/Images/Geo_lookup_world_map_599x305.png" style="width: 599;height: 305;" /><br /><br /></li>
            <li value="3">Do any of the following:</li>
        </ol>
        <ul>
            <li value="1">Use the zoom slider to zoom in or out on an area of the map. Alternately, click and drag to zoom in or see different areas of a map.</li>
            <li value="2">Click <b>Satellite</b> or <b>Map</b> to view a satellite or map view.</li>
            <li value="3">Click any marker on the map to see more detail about where IPs originate in a specific area:<br /><br /><img src="Resources/Images/Geo_lookup_zoom_403x289.png" style="width: 403;height: 289;" /><br /><br /></li>
        </ul>
        <ol>
            <li value="4">(Optional) Click <b>Add to Dashboard</b> to create a new Dashboard or add the map to an existing Dashboard.<br /><br /><img src="Resources/Images/Geo_lookup_Dashboard_593x266.png" style="width: 593;height: 266;" /><br /><br />After adding a map to a Dashboard you'll still be able to zoom in and drill down on the data.<br /></li>
        </ol>
        <p>&#160;</p>
        <p>&#160;</p>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom" style="display: none;"><a href="Default.htm#Geo_lookup_operator.htm">Open topic with navigation</a>
        </p>
    </body>
</html>