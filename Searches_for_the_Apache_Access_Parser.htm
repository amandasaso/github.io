<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="no-feedback" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Search|Suggested Searches">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Searches for the Apache Access Parser</title>
        <link href="Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="Resources/Stylesheets/Styles.css" rel="stylesheet" />
        <script src="Resources/Scripts/jquery.min.js">
        </script>
        <script src="Resources/Scripts/plugins.min.js">
        </script>
        <script src="Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop" style="display: none;"><a href="Default.htm#Searches_for_the_Apache_Access_Parser.htm">Open topic with navigation</a>
        </p>
        <script type="text/javascript">/* <![CDATA[ */
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-16579649-1']);
			_gaq.push(['_trackPageview']);
			(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		/* ]]> */</script>
        <h1>Searches for the Apache Access Parser</h1>
        <p>The following searches were built for use with the Apache Access Parser. Copy and paste these searches into the search query field and save them for use later. </p>
        <p>To obtain the best results possible, be sure to make the following modifications to the example queries:</p>
        <ul>
            <li value="1">Use a specific keyword expression or metadata search to limit the initial results to Apache logs. [Replace _the metadata search expression "sourceName=*error_log* AND _sourceCategory=*apache*" in the examples]</li>
            <li value="2">Change the time range and the timeslice values to tailor the results to your needs.</li>
        </ul>
        <h2 data-mc-conditions="">Understanding Incoming Requests</h2>
        <p data-mc-conditions="">Use these searches for troubleshooting and performance monitoring.</p>
        <p data-mc-conditions=""><b>All HTTP Response codes with their count</b>
        </p>
        <p data-mc-conditions="">This search returns the number of requests observed per HTTP status code. 	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -1d</li>
            <li value="2" data-mc-conditions="">_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access | count by status_code | sort by _count</li>
        </ul>
        <p data-mc-conditions=""><b>Client Errors (4xx response codes)  per day</b>
        </p>
        <p data-mc-conditions="">Returns the number of errors caused by web clients over the past 7 days. This search can be used to detect if these errors are increasing or decreasing over time. These kinds of errors can either indicate whether the number of attacks to the website are increasing (e.g. 403 Forbidden responses) or whether website changes are causing more errors.    	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -7d	</li>
            <li value="2" data-mc-conditions="">_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access | where status_code matches "4*" | timeslice by 1d | count by _timeslice</li>
        </ul>
        <p data-mc-conditions=""><b>Server Response Summary Over Time</b>
        </p>
        <p data-mc-conditions="">Returns the number of client errors, server errors, redirects and successful responses observed each day over the last 7 days. This search can be used to understand the distribution of errors vs. successful responses and redirects. </p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -7d	</li>
            <li value="2" data-mc-conditions=""> <![CDATA[	]]>_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access | if(status_code matches "2*", 1, 0) as successes | if(status_code matches "5*", 1, 0) as server_errors | if(status_code matches "4*", 1, 0) as client_errors | timeslice by 1d | sum(successes) as successes, sum(client_errors) as client_errors,  sum(server_errors) as server_errors by _timeslice</li>
        </ul>
        <p data-mc-conditions=""><b>Top 404 referrers</b>
        </p>
        <p data-mc-conditions="">Returns the top 100 URLS that refer to a resource that does not exist on the website. This information can be used to fix existing web pages. 	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -1d</li>
            <li value="2" data-mc-conditions="">(_sourceName=*access_log* AND _sourceCategory=*apache*) AND "404" | parse using public/apache/access |  where status_code="404" | count_frequent referrer | limit 100</li>
        </ul>
        <p data-mc-conditions=""><b>Top Clients Causing Errors</b>
        </p>
        <p data-mc-conditions="">Returns the top source IP addresses that are responsible for client errors on the website, which can help in blocking certain IP addresses or IP address ranges from accessing the website. 	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -1d</li>
            <li value="2" data-mc-conditions="">_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access |  where status_code matches "4*" | count_frequent src_ip | limit 100</li>
        </ul>
        <h2 data-mc-conditions="">Understand Incoming Traffic </h2>
        <p data-mc-conditions="">The following searches can help you get information about the volume of traffic and the amount of bytes served by your website over a period of time. In addition, the searches can help you learn more about the  browsers and devices accessing your site.	 	 
</p>
        <p data-mc-conditions=""><b>Traffic volume and bytes served per day</b>
        </p>
        <p data-mc-conditions="">Returns the number of bytes served and the number of hits to the website each day over the past day. If run over a longer period of time (say 2 weeks or a month), this also may give a good idea of which days of the week are more busy than others. 	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -7d</li>
            <li value="2" data-mc-conditions="">_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access | (size/1000000) as mbytes | timeslice by 1d | sum(mbytes) as Bytes_Served_mb, count as hits by _timeslice </li>
        </ul>
        <p data-mc-conditions=""><b>Top clients</b>
        </p>
        <p data-mc-conditions="">This search returns the top 100 IP addresses that cause the most hits to the website. 	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -1d up to -7d</li>
            <li value="2" data-mc-conditions="">_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access | count_frequent src_ip 
</li>
        </ul>
        <p data-mc-conditions=""><b>Top browsers</b>
        </p>
        <p data-mc-conditions="">This search returns the top 100 browsers that are accessing the website. 	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -1d  	</li>
            <li value="2" data-mc-conditions="">_sourceName=*access_log* AND _sourceCategory=*apache*  | parse using public/apache/access | count_frequent user_agent | limit 100 
</li>
        </ul>
        <p data-mc-conditions=""><b>Robots</b>
        </p>
        <p data-mc-conditions="">This search returns a list of all robots that are accessing the website, assuming that robots first access the robots.txt file before actually crawling through the website. 	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -1d 	</li>
            <li value="2" data-mc-conditions="">(_sourceName=*access_log* AND _sourceCategory=*apache*) AND "/robots.txt" | parse using public/apache/access  | count_frequent user_agent 
</li>
        </ul>
        <h2 data-mc-conditions="">Understand Page-Served Time	 	 
</h2>
        <p data-mc-conditions=""><b>Time taken to serve requests</b>
        </p>
        <p data-mc-conditions="">This search adds the time taken in seconds, microseconds and minutes to serve the requests as additional fields. It can be used to get quick insight into the performance of the server at present. </p>
        <p class="Note" data-mc-conditions="">This is assuming that the <b>%T/%D</b> logging directive is added to the access log where <b>%T</b> is the number of seconds and <b>%D</b> is the number of microseconds taken to serve the request.	</p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -30m 	</li>
            <li value="2" data-mc-conditions="">_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access | extract " (?&lt;seconds&gt;\d+)/(?&lt;microseconds&gt;\d+)$"  | toLong(microseconds/(1000000*60)) as minutes </li>
        </ul>
        <h2 data-mc-conditions=""> 
URLs and Bytes Served Statistics	 	 
</h2>
        <p data-mc-conditions=""><b>Malicious URL requests</b>
        </p>
        <p data-mc-conditions="">Get information on incoming client request URLs which are sent for malicious reasons. These may or may not cause client or server errors. </p>
        <ul>
            <li value="1" data-mc-conditions="">Suggested Time Range: -2h 	</li>
            <li value="2" data-mc-conditions="">(_sourceName=*access_log* AND _sourceCategory=*apache*) AND ("jsessionid" OR "old" OR "bak") | parse using public/apache/access |  where url matches "*.old" OR url matches "*.bak" OR url matches "*jsessionid=*" 
</li>
        </ul>
        <p><b>Top URLs by bytes served</b> <![CDATA[ 	]]></p>
        <ul>
            <li value="1">Suggested Time Range: -1d 	</li>
            <li value="2">_sourceName=*access_log* AND _sourceCategory=*apache* | parse using public/apache/access | avg(size) as average_size_KB by url | sort by average_size_KB | limit 100 | (average_size_KB/1000) as average_size_KB | (toLong(average_size_KB*100)/100) as average_size_KB 
</li>
        </ul>
        <p>&#160;</p>
        <p>&#160;</p>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom" style="display: none;"><a href="Default.htm#Searches_for_the_Apache_Access_Parser.htm">Open topic with navigation</a>
        </p>
    </body>
</html>